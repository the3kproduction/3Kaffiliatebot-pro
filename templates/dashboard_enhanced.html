<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AffiliateBot Pro - Enhanced Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header h1 { color: #333; font-size: 2.5em; margin-bottom: 10px; }
        .user-info { color: #666; font-size: 1.1em; }
        
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .card h3 { color: #333; margin-bottom: 15px; font-size: 1.4em; }
        
        .stats-card { text-align: center; }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 1.1em; }
        
        .platform-status { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .platform-badge { padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 0.9em; }
        .status-connected { background: #d4edda; color: #155724; }
        .status-disconnected { background: #f8d7da; color: #721c24; }
        .status-testing { background: #fff3cd; color: #856404; }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .product-card { background: #f8f9fa; border-radius: 10px; padding: 15px; border: 2px solid #e9ecef; transition: all 0.3s ease; }
        .product-card:hover { border-color: #667eea; transform: scale(1.02); }
        .product-image { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        .product-title { font-weight: bold; margin-bottom: 8px; color: #333; }
        .product-price { color: #667eea; font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .product-rating { color: #ffc107; margin-bottom: 10px; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a6fd8; transform: translateY(-2px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        
        .analytics-chart { background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .chart-bar { height: 30px; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 15px; margin: 10px 0; position: relative; }
        .chart-label { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: white; font-weight: bold; }
        
        /* Floating Radio Player Styles */
        .radio-player { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px; padding: 15px; width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; transition: all 0.3s ease; }
        .radio-player.minimized { width: 60px; height: 60px; padding: 10px; }
        .radio-player.minimized .player-content { display: none; }
        .radio-player.minimized .minimize-btn { transform: rotate(180deg); }
        
        /* Music Playing Animations */
        .radio-player.playing { animation: subtlePulse 2s ease-in-out infinite; }
        .radio-player.playing::before { content: ''; position: absolute; top: -3px; left: -3px; right: -3px; bottom: -3px; border-radius: 18px; background: linear-gradient(45deg, #667eea, #764ba2, #667eea); z-index: -1; animation: colorShift 4s ease-in-out infinite; opacity: 0.7; }
        .radio-player.playing .player-title::after { content: ' ♪'; animation: musicNote 1.5s ease-in-out infinite; }
        
        @keyframes subtlePulse {
            0%, 100% { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 15px 40px rgba(102,126,234,0.4); }
        }
        
        @keyframes colorShift {
            0%, 100% { background: linear-gradient(45deg, #667eea, #764ba2, #667eea); }
            25% { background: linear-gradient(45deg, #764ba2, #667eea, #764ba2); }
            50% { background: linear-gradient(45deg, #667eea, #764ba2, #667eea); }
            75% { background: linear-gradient(45deg, #764ba2, #667eea, #764ba2); }
        }
        
        @keyframes musicNote {
            0%, 100% { opacity: 1; transform: translateY(0); }
            50% { opacity: 0.7; transform: translateY(-2px); }
        }
        
        /* Volume visualizer bars */
        .volume-visualizer { display: flex; align-items: center; gap: 2px; margin-left: 10px; }
        .volume-bar { width: 3px; background: rgba(255,255,255,0.6); border-radius: 2px; animation: volumeBounce 0.8s ease-in-out infinite; }
        .volume-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
        .volume-bar:nth-child(2) { height: 12px; animation-delay: 0.1s; }
        .volume-bar:nth-child(3) { height: 16px; animation-delay: 0.2s; }
        .volume-bar:nth-child(4) { height: 10px; animation-delay: 0.3s; }
        
        @keyframes volumeBounce {
            0%, 100% { transform: scaleY(0.3); opacity: 0.4; }
            50% { transform: scaleY(1); opacity: 1; }
        }
        .player-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .player-title { font-weight: bold; font-size: 14px; }
        .minimize-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-size: 12px; }
        .station-selector { 
            width: 100%; 
            background: rgba(255,255,255,0.1); 
            border: none; 
            color: white; 
            padding: 8px; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            position: relative; 
            z-index: 1002;
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }
        .station-selector option { 
            background: #333; 
            color: white; 
            padding: 8px; 
            border: none;
        }
        .station-selector option:hover {
            background: #555;
        }
        .player-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .control-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 16px; transition: all 0.3s ease; }
        .control-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }
        .volume-control { display: flex; align-items: center; gap: 10px; }
        .volume-slider { width: 100%; }
        .now-playing { font-size: 12px; opacity: 0.8; text-align: center; margin-top: 5px; }
        
        .webhook-item { background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0; border-left: 5px solid #667eea; }
        .webhook-status { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        .status-green { background: #28a745; }
        .status-red { background: #dc3545; }
        .status-gray { background: #6c757d; }
        
        .schedule-controls { background: #e9ecef; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .frequency-selector { display: flex; gap: 15px; align-items: center; margin: 15px 0; }
        .frequency-selector label { font-weight: bold; }
        .frequency-selector select { padding: 8px 12px; border-radius: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>🚀 AffiliateBot Pro Enhanced Dashboard</h1>
                <div class="user-info">
                    Welcome back, {{ user.first_name or user.email }}! 
                    <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">
                        {{ user.subscription_tier|title }} Member
                    </span>
                </div>
            </div>
            <a href="/logout" class="btn btn-danger" style="background: #dc3545; color: white; text-decoration: none; padding: 12px 20px; border-radius: 8px; font-weight: bold;">
                🚪 Logout
            </a>
        </div>

        <!-- PROMINENT Problem Reporting Section -->
        <div style="background: linear-gradient(45deg, #ff4757, #ff3838); border: 3px solid #ff6b6b; border-radius: 15px; padding: 20px; margin: 20px 0; box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3); animation: pulse 2s infinite;">
            <div style="text-align: center; margin-bottom: 15px;">
                <h2 style="color: white; margin: 0; font-size: 24px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">🚨 HAVING ISSUES? GET HELP NOW! 🚨</h2>
                <p style="color: rgba(255,255,255,0.9); margin: 10px 0; font-size: 16px;">Something not working? Report it instantly and we'll fix it fast!</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 15px; align-items: end;">
                <select id="problemType" style="width: 100%; padding: 12px; border: none; border-radius: 10px; font-size: 14px; font-weight: bold;">
                    <option value="">Select Problem Type</option>
                    <option value="posting_failed">❌ Posting Failed</option>
                    <option value="ai_promotion_error">🤖 AI Auto-Promotion Error</option>
                    <option value="platform_connection">🔗 Platform Connection Issues</option>
                    <option value="affiliate_links">💰 Affiliate Links Not Working</option>
                    <option value="dashboard_bug">🐛 Dashboard Bug/Error</option>
                    <option value="payment_billing">💳 Payment/Billing Issue</option>
                    <option value="other">❓ Other Issue</option>
                </select>
                
                <textarea id="problemDescription" placeholder="Describe what's broken or not working..." style="width: 100%; height: 60px; padding: 12px; border: none; border-radius: 10px; resize: none; font-family: inherit; font-size: 14px;"></textarea>
                
                <button onclick="reportProblem()" style="width: 100%; background: white; color: #ff4757; font-weight: bold; padding: 15px 20px; border-radius: 10px; border: none; cursor: pointer; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s;">
                    📧 SEND REPORT
                </button>
            </div>
            
            <div id="problemReportResult" style="margin-top: 15px; display: none; text-align: center;"></div>
        </div>
        
        <style>
            @keyframes pulse {
                0% { box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3); }
                50% { box-shadow: 0 8px 35px rgba(255, 71, 87, 0.5); }
                100% { box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3); }
            }
        </style>

        <!-- Smart Setup Notification -->
        {% set missing_items = [] %}
        {% if not user.amazon_affiliate_id or user.amazon_affiliate_id == '' %}
            {% set _ = missing_items.append('Amazon Associate ID') %}
        {% endif %}
        {% if not user.discord_webhook_url or user.discord_webhook_url == '' %}
            {% set _ = missing_items.append('Discord webhook') %}
        {% endif %}
        {% if not user.telegram_bot_token or user.telegram_bot_token == '' %}
            {% set _ = missing_items.append('Telegram bot') %}
        {% endif %}
        {% if not user.slack_bot_token or user.slack_bot_token == '' %}
            {% set _ = missing_items.append('Slack bot') %}
        {% endif %}
        {% if not user.sendgrid_api_key or user.sendgrid_api_key == '' %}
            {% set _ = missing_items.append('Email service') %}
        {% endif %}

        {% if missing_items and not user.setup_notification_dismissed %}
        <div id="setup-notification" class="card" style="border: 3px solid #ffc107; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); position: relative;">
            <button onclick="dismissNotification()" style="position: absolute; top: 10px; right: 15px; background: rgba(255,255,255,0.8); border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold; color: #666;">×</button>
            
            <h3>⚠️ Complete Your Setup to Start Earning!</h3>
            <p style="margin: 15px 0; font-size: 1.1em;">You're missing setup for: <strong>{{ missing_items|join(', ') }}</strong></p>
            
            {% if not user.amazon_affiliate_id %}
            <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; margin: 15px 0;">
                <strong>Don't have an Amazon Associates account yet?</strong><br>
                1. Go to <a href="https://affiliate-program.amazon.com" target="_blank" style="color: #667eea;">affiliate-program.amazon.com</a><br>
                2. Sign up for free<br>
                3. Get your Associate ID (looks like "yourname-20")<br>
                4. Come back and enter it below
            </div>
            {% endif %}
            
            <a href="/setup" class="btn btn-warning" style="font-size: 1.2em; padding: 15px 30px;">💰 Complete Setup Now</a>
        </div>

        <script>
        function dismissNotification() {
            fetch('/dismiss-setup-notification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('setup-notification').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error dismissing notification:', error);
            });
        }
        </script>
        {% endif %}

        <!-- Upgrade Promotion for Free Users (Top Priority) -->
        {% if user.subscription_tier == 'free' %}
        <div class="card" style="background: linear-gradient(135deg, #ffd700, #ff8c00); color: white; border: 3px solid #ffd700; margin-bottom: 25px;">
            <h3>🚀 Upgrade to Unlock Premium Features!</h3>
            <p style="opacity: 0.9; margin-bottom: 20px;">You're currently on the Free plan (2 posts/day). Upgrade to access powerful features:</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                    <h4 style="margin: 0 0 10px 0;">💎 Premium - $29/month</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>8 posts per day</li>
                        <li>Amazon product search</li>
                        <li>Advanced analytics</li>
                        <li>Priority support</li>
                    </ul>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                    <h4 style="margin: 0 0 10px 0;">🔥 Pro - $79/month</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>24 posts per day</li>
                        <li>AI auto-promotion</li>
                        <li>All Premium features</li>
                        <li>White-label access</li>
                    </ul>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button onclick="alert('Coming soon! Stripe payment integration will be available shortly.')" style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Try Premium Free for 7 Days
                </button>
                <button onclick="alert('Coming soon! Stripe payment integration will be available shortly.')" style="background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Try Pro Free for 7 Days
                </button>
            </div>
        </div>
        {% endif %}

        <!-- Platform Setup Section -->
        <div class="card" style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; margin-bottom: 25px;">
            <h3>🔧 Platform Setup</h3>
            <p>Connect your social media platforms to start posting</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <!-- Discord Setup -->
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                    <h4>💬 Discord</h4>
                    <input type="url" id="discord_webhook" placeholder="Discord Webhook URL" style="width: 100%; padding: 8px; margin: 10px 0; border: none; border-radius: 5px;" value="{{ user.discord_webhook_url or '' }}">
                    <button onclick="saveDiscord()" style="background: #7289da; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Discord</button>
                </div>
                
                <!-- Telegram Setup -->
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                    <h4>📱 Telegram</h4>
                    <input type="text" id="telegram_bot_token" placeholder="Bot Token" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.telegram_bot_token or '' }}">
                    <input type="text" id="telegram_chat_id" placeholder="Chat ID" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.telegram_chat_id or '' }}">
                    <button onclick="saveTelegram()" style="background: #0088cc; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Telegram</button>
                </div>
                
                <!-- Slack Setup -->
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                    <h4>💼 Slack</h4>
                    <input type="text" id="slack_bot_token" placeholder="Bot Token" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.slack_bot_token or '' }}">
                    <input type="text" id="slack_channel_id" placeholder="Channel ID" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.slack_channel_id or '' }}">
                    <button onclick="saveSlack()" style="background: #4a154b; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Slack</button>
                </div>
            </div>
        </div>

        <!-- Analytics Overview -->
        <div class="dashboard-grid">
            <div class="card stats-card">
                <h3>💰 Total Revenue</h3>
                <div class="stat-number">${{ "%.2f"|format(analytics.estimated_revenue or 0) }}</div>
                <div class="stat-label">Estimated Earnings</div>
            </div>
            <div class="card stats-card">
                <h3>📊 Total Posts</h3>
                <div class="stat-number">{{ analytics.total_posts or 0 }}</div>
                <div class="stat-label">Products Promoted</div>
            </div>
            <div class="card stats-card">
                <h3>👆 Total Clicks</h3>
                <div class="stat-number">{{ analytics.total_clicks or 0 }}</div>
                <div class="stat-label">Affiliate Clicks</div>
            </div>
            <div class="card stats-card">
                <h3>📈 Conversion Rate</h3>
                <div class="stat-number">{{ "%.1f"|format(analytics.conversion_rate or 0) }}%</div>
                <div class="stat-label">Click to Sale</div>
            </div>
        </div>

        <!-- Help & Quick Actions -->
        <div class="card" style="background: linear-gradient(135deg, #00b894, #00cec9); color: white; margin-bottom: 25px;">
            <h3>📚 Quick Access</h3>
            <p>Essential resources and helpful guides</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                <a href="/help" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 12px 20px; text-align: center;">📖 Complete Setup Guide & FAQ</a>
                <button onclick="togglePlatformSetup()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 12px 20px; cursor: pointer;">⚙️ Platform Settings</button>
                <a href="/analytics" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 12px 20px; text-align: center;">📊 View Analytics</a>
            </div>
        </div>

        <!-- Admin Panel (moved to top) -->
        {% if user.is_admin %}
        <div class="card" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; border: 3px solid #ff9ff3;">
            <h3>👑 Admin Panel</h3>
            <p>Manage users and send email campaigns</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                <a href="/admin" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none;">Admin Dashboard</a>
                <a href="/admin/users" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none;">View Users</a>
                <a href="/admin/email-blast" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none;">Send Email Blast</a>
                <a href="/admin/product-catalog" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none;">🛍️ Product Catalog</a>
            </div>
        </div>
        {% endif %}

        <!-- Platform Settings - Always Accessible -->
        <div class="card" style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; margin-bottom: 25px;">
            <h3>⚙️ Platform Settings</h3>
            <p>Manage your social media connections and webhook configurations</p>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 15px;">
                <button onclick="togglePlatformSetup()" id="platform-settings-btn" style="background: rgba(255,255,255,0.2); color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    🔧 Configure Platforms
                </button>
                <button onclick="testConnections()" style="background: rgba(255,255,255,0.2); color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    🧪 Test Connections
                </button>
            </div>
            
            <!-- Hidden platform setup form -->
            <div id="platform-setup-form" style="display: none; margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Discord Setup -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <h4>💬 Discord</h4>
                        <input type="url" id="discord_webhook_setup" placeholder="Discord Webhook URL" style="width: 100%; padding: 8px; margin: 10px 0; border: none; border-radius: 5px;" value="{{ user.discord_webhook_url or '' }}">
                        <button onclick="saveDiscordSetup()" style="background: #7289da; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Discord</button>
                    </div>
                    
                    <!-- Telegram Setup -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <h4>📱 Telegram</h4>
                        <input type="text" id="telegram_bot_token_setup" placeholder="Bot Token" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.telegram_bot_token or '' }}">
                        <input type="text" id="telegram_chat_id_setup" placeholder="Chat ID" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.telegram_chat_id or '' }}">
                        <button onclick="saveTelegramSetup()" style="background: #0088cc; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Telegram</button>
                    </div>
                    
                    <!-- Slack Setup -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <h4>💼 Slack</h4>
                        <input type="text" id="slack_bot_token_setup" placeholder="Bot Token" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.slack_bot_token or '' }}">
                        <input type="text" id="slack_channel_id_setup" placeholder="Channel ID" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.slack_channel_id or '' }}">
                        <button onclick="saveSlackSetup()" style="background: #4a154b; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Slack</button>
                    </div>
                    
                    <!-- Pinterest Setup -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <h4>📌 Pinterest</h4>
                        <input type="text" id="pinterest_access_token_setup" placeholder="Access Token" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.pinterest_access_token or '' }}">
                        <input type="text" id="pinterest_board_id_setup" placeholder="Board ID" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.pinterest_board_id or '' }}">
                        <button onclick="savePinterestSetup()" style="background: #bd081c; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Pinterest</button>
                    </div>
                    
                    <!-- Reddit Setup -->
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <h4>🔴 Reddit</h4>
                        <input type="text" id="reddit_client_id_setup" placeholder="Client ID" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.reddit_client_id or '' }}">
                        <input type="text" id="reddit_client_secret_setup" placeholder="Client Secret" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.reddit_client_secret or '' }}">
                        <input type="text" id="reddit_username_setup" placeholder="Username" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.reddit_username or '' }}">
                        <input type="password" id="reddit_password_setup" placeholder="Password" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;">
                        <input type="text" id="reddit_subreddit_setup" placeholder="Subreddit (e.g., deals)" style="width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;" value="{{ user.reddit_subreddit or '' }}">
                        <button onclick="saveRedditSetup()" style="background: #ff4500; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;">Save Reddit</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Analytics (moved under admin) -->
        <div class="card" style="background: linear-gradient(135deg, #74b9ff, #0984e3); color: white;">
            <h3>📊 Performance Analytics</h3>
            {% if user.subscription_tier == 'free' %}
            <p>Track clicks, conversions, and revenue <span style="background: rgba(255,193,7,0.9); color: #000; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-left: 10px;">PREMIUM+</span></p>
            <div style="display: flex; justify-content: center; margin-top: 15px;">
                <button onclick="alert('Analytics are available for Premium and Pro members only. Upgrade to unlock detailed performance tracking!')" class="btn" style="background: rgba(255,255,255,0.3); color: white; text-decoration: none; text-align: center; padding: 12px 24px; border: none; cursor: pointer; opacity: 0.7;">🔒 View Analytics</button>
            </div>
            {% else %}
            <p>Track clicks, conversions, and revenue</p>
            <div style="display: flex; justify-content: center; margin-top: 15px;">
                <a href="/analytics" class="btn" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none; text-align: center; padding: 12px 24px;">View Analytics</a>
            </div>
            {% endif %}
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h3>⚡ Quick Actions</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                {% if user.subscription_tier == 'free' %}
                <button onclick="alert('Product browsing is available for Premium and Pro members only. Upgrade to access thousands of products!')" class="btn" style="background: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; opacity: 0.7; text-decoration: none;">🔒 Browse Products</button>
                {% else %}
                <a href="/products" class="btn btn-primary" style="text-decoration: none;">Browse Products</a>
                {% endif %}
                <a href="/campaigns" class="btn btn-success" style="text-decoration: none;">Manage Campaigns</a>
                <a href="/setup" class="btn btn-warning" style="text-decoration: none;">Setup Webhooks</a>
            </div>
        </div>

        <!-- AI Auto-Promotion -->
        <div class="card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
            <h3>🤖 AI Auto-Promotion</h3>
            {% if user.subscription_tier == 'free' %}
            <p style="margin-bottom: 20px; opacity: 0.9;">Let AI automatically select and promote your top products <span style="background: rgba(52,144,220,0.9); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-left: 10px;">1 FREE / 5 HOURS</span></p>
            
            <button onclick="alert('Multiple promotions available for Pro members only. Free users get 1 promotion every 5 hours.')" style="width: 100%; background: rgba(255,255,255,0.3); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px; opacity: 0.7;">
                🔒 Auto-Promote Top 3 Products
            </button>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="autoPromoteProducts(1)" style="background: rgba(255,255,255,0.2); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    🎯 Promote 1 (FREE)
                </button>
                <button onclick="alert('Multiple promotions available for Pro members only!')" style="background: rgba(255,255,255,0.3); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; opacity: 0.7;">
                    🔒 Promote 5
                </button>
            </div>
            {% elif user.subscription_tier == 'premium' %}
            <p style="margin-bottom: 20px; opacity: 0.9;">Let AI automatically select and promote your top products <span style="background: rgba(255,193,7,0.9); color: #000; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-left: 10px;">PRO ONLY</span></p>
            
            <button onclick="alert('AI auto-promotion is available for Pro members only. Upgrade to unlock advanced automation features!')" style="width: 100%; background: rgba(255,255,255,0.3); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px; opacity: 0.7;">
                🔒 Auto-Promote Top 3 Products
            </button>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="alert('AI auto-promotion is available for Pro members only!')" style="background: rgba(255,255,255,0.3); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; opacity: 0.7;">
                    🔒 Promote 1
                </button>
                <button onclick="alert('AI auto-promotion is available for Pro members only!')" style="background: rgba(255,255,255,0.3); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; opacity: 0.7;">
                    🔒 Promote 5
                </button>
            </div>
            {% else %}
            <p style="margin-bottom: 20px; opacity: 0.9;">Let AI automatically select and promote your top products</p>
            
            <button onclick="autoPromoteProducts(3)" style="width: 100%; background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px;">
                🚀 Auto-Promote Top 3 Products
            </button>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="promoteProducts(1)" style="background: rgba(255,255,255,0.2); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Promote 1
                </button>
                <button onclick="promoteProducts(5)" style="background: rgba(255,255,255,0.2); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Promote 5
                </button>
            </div>
            {% endif %}
            
            <div id="auto-promote-result" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
        </div>



        <!-- Amazon Product Search -->
        <div class="card" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white;">
            <h3>🔍 Amazon Product Search</h3>
            {% if user.subscription_tier == 'free' %}
            <p style="margin-bottom: 20px; opacity: 0.9;">Search Amazon directly and add products to your inventory <span style="background: rgba(255,193,7,0.9); color: #000; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-left: 10px;">PREMIUM+</span></p>
            
            <input type="text" placeholder="Search any product..." style="width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; margin-bottom: 15px; color: #333; opacity: 0.7;" disabled>
            
            <button onclick="alert('Amazon product search is available for Premium and Pro members only. Upgrade to unlock thousands of products!')" style="width: 100%; background: rgba(255,255,255,0.3); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px; opacity: 0.7;">
                🔒 Search & Add to Inventory
            </button>
            {% else %}
            <p style="margin-bottom: 20px; opacity: 0.9;">Search Amazon directly and add products to your inventory</p>
            
            <input type="text" id="product-search-input" placeholder="Search any product..." style="width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; margin-bottom: 15px; color: #333;">
            
            <button onclick="searchProducts()" style="width: 100%; background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px;">
                Search & Add to Inventory
            </button>
            {% endif %}
            
            {% if trending_searches %}
            <div style="margin-top: 15px;">
                <p style="margin-bottom: 10px; opacity: 0.9; font-size: 14px;">Trending searches:</p>
                <div>
                    {% for search in trending_searches %}
                    <span onclick="searchPreset('{{ search }}')" style="background: rgba(255,255,255,0.2); color: white; padding: 6px 12px; border-radius: 15px; margin: 3px; display: inline-block; cursor: pointer; font-size: 12px;">
                        {{ search }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <div id="search-result" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
        </div>

        <!-- Platform Status -->
        <div class="card">
            <h3>🔗 Platform Connection Status</h3>
            <div class="platform-status">
                {% for webhook in user_webhooks %}
                <div class="platform-badge {{ 'status-connected' if webhook.last_test_success else 'status-disconnected' if webhook.last_test_time else 'status-testing' }}">
                    <span class="webhook-status {{ 'status-green' if webhook.last_test_success else 'status-red' if webhook.last_test_time else 'status-gray' }}"></span>
                    {{ webhook.name }} ({{ webhook.platform|title }})
                    <a href="/test-webhook/{{ webhook.id }}" class="btn btn-primary" style="margin-left: 10px; padding: 4px 8px; font-size: 0.8em;">Test</a>
                </div>
                {% endfor %}
            </div>
            <a href="/setup-webhooks" class="btn btn-primary">+ Add New Platform</a>
        </div>

        <!-- Product Selection with Visual Preview -->
        <div class="card">
            <h3>🛍️ Smart Product Selection</h3>
            <p style="color: #666; margin-bottom: 20px;">AI-curated products avoiding recent duplicates</p>
            
            <div class="product-grid">
                {% for product in trending_products[:6] %}
                <div class="product-card" onclick="selectProduct('{{ product.asin }}')">
                    <img src="{{ product.image_url or '/static/placeholder-product.png' }}" alt="{{ product.product_title }}" class="product-image">
                    <div class="product-title">{{ product.product_title[:50] }}...</div>
                    <div class="product-price">{{ product.price or 'Check Price' }}</div>
                    <div class="product-rating">⭐ {{ product.rating or 'N/A' }}/5</div>
                    <div style="font-size: 0.9em; color: #666;">
                        Promoted {{ product.times_promoted or 0 }} times
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div style="margin-top: 20px;">
                <a href="/products/refresh" class="btn btn-warning">🔄 Refresh Products</a>
                <a href="/products/browse" class="btn btn-primary">📱 Browse All Products</a>
            </div>
        </div>

        <!-- Scheduling Configuration -->
        <div class="card">
            <h3>⏰ Smart Scheduling & Frequency</h3>
            <div class="schedule-controls">
                <div class="frequency-selector">
                    <label>Posting Frequency:</label>
                    <select onchange="updateFrequency(this.value)">
                        <option value="1" {{ 'selected' if user.post_frequency_hours == 1 else '' }}>Every Hour (Pro)</option>
                        <option value="3" {{ 'selected' if user.post_frequency_hours == 3 else '' }}>Every 3 Hours (Premium)</option>
                        <option value="12" {{ 'selected' if user.post_frequency_hours == 12 else '' }}>Every 12 Hours (Free)</option>
                    </select>
                </div>
                
                <div style="margin: 15px 0;">
                    <label style="font-weight: bold;">Auto-Posting:</label>
                    <button onclick="toggleAutoPosts()" class="btn {{ 'btn-success' if user.auto_post_enabled else 'btn-warning' }}">
                        {{ 'ON' if user.auto_post_enabled else 'OFF' }}
                    </button>
                </div>
                
                <div style="font-size: 0.9em; color: #666;">
                    Next scheduled post: <strong>{{ next_post_time or 'Manual only' }}</strong>
                </div>
            </div>
        </div>



        <!-- Mini Analytics Dashboard -->
        <div class="card">
            <h3>📊 Performance Analytics</h3>
            
            <div class="analytics-chart">
                <h4>Platform Performance</h4>
                {% for platform, stats in analytics.platform_stats.items() %}
                <div style="margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>{{ platform|title }}</span>
                        <span>{{ stats.posts }} posts, {{ stats.clicks }} clicks</span>
                    </div>
                    <div class="chart-bar" style="width: {{ (stats.clicks / (analytics.total_clicks or 1) * 100)|round }}%;">
                        <div class="chart-label">{{ stats.clicks }} clicks</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div style="margin-top: 20px;">
                <a href="/analytics/detailed" class="btn btn-primary">📈 Detailed Analytics</a>
                <a href="/analytics/export" class="btn btn-success">📊 Export Data</a>
            </div>
        </div>


    </div>

    <!-- Floating Radio Player -->
    <div class="radio-player" id="radioPlayer">
        <div class="player-header">
            <span class="player-title">🎵 Member Radio</span>
            <div class="volume-visualizer" id="volumeVisualizer" style="display: none;">
                <div class="volume-bar"></div>
                <div class="volume-bar"></div>
                <div class="volume-bar"></div>
                <div class="volume-bar"></div>
            </div>
            <button class="minimize-btn" onclick="togglePlayer()">−</button>
        </div>
        <div class="player-content">
            <!-- Genre Filter Tabs -->
            <div style="display: flex; margin-bottom: 10px; flex-wrap: wrap; gap: 4px;">
                <button class="genre-tab active" onclick="filterByGenre('all')" id="allTab" style="padding: 4px 8px; background: rgba(255,255,255,0.3); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 10px;">
                    All
                </button>
                <button class="genre-tab" onclick="filterByGenre('chill')" id="chillTab" style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 10px;">
                    Chill
                </button>
                <button class="genre-tab" onclick="filterByGenre('electronic')" id="electronicTab" style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 10px;">
                    Electronic
                </button>
                <button class="genre-tab" onclick="filterByGenre('jazz')" id="jazzTab" style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 10px;">
                    Jazz
                </button>
                <button class="genre-tab" onclick="filterByGenre('ambient')" id="ambientTab" style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 10px;">
                    Ambient
                </button>
                <button class="genre-tab" onclick="filterByGenre('rock')" id="rockTab" style="padding: 4px 8px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 12px; cursor: pointer; font-size: 10px;">
                    Rock
                </button>
            </div>
            
            <!-- Radio Station Selector -->
            <select class="station-selector" id="stationSelector" onchange="changeStation()" size="1">
                <option value="">🎵 Select a Radio Station</option>
                
                <!-- CHILL -->
                <option value="http://ice1.somafm.com/groovesalad-256-mp3" data-genre="chill">🍃 Groove Salad - Downtempo Chill</option>
                <option value="http://ice1.somafm.com/lush-128-mp3" data-genre="chill">🌿 Lush - Sensual & Luxurious</option>
                <option value="http://ice1.somafm.com/secretagent-128-mp3" data-genre="chill">🕶️ Secret Agent - Lounge Vibes</option>
                <option value="http://ice1.somafm.com/digitalis-128-mp3" data-genre="chill">💊 Digitalis - Indie Downtempo</option>
                <option value="http://ice1.somafm.com/illstreet-128-mp3" data-genre="chill">🎯 Illinois Street Lounge</option>
                
                <!-- ELECTRONIC -->
                <option value="http://ice1.somafm.com/defcon-256-mp3" data-genre="electronic">⚡ DEF CON Radio - Hacker Tunes</option>
                <option value="http://ice1.somafm.com/beatblender-128-mp3" data-genre="electronic">🎛️ Beat Blender - Electronic Mix</option>
                <option value="http://ice1.somafm.com/suburbsofgoa-128-mp3" data-genre="electronic">🏖️ Suburbs of Goa - Trance</option>
                <option value="http://ice1.somafm.com/thetrip-128-mp3" data-genre="electronic">🌈 The Trip - Progressive House</option>
                <option value="http://ice1.somafm.com/cliqhop-256-mp3" data-genre="electronic">🔊 cliqhop idm - Glitch Beats</option>
                <option value="http://ice1.somafm.com/poptron-128-mp3" data-genre="electronic">📺 PopTron - Electro-Pop</option>
                
                <!-- JAZZ & SOUL -->
                <option value="http://ice1.somafm.com/seventy-128-mp3" data-genre="jazz">🎷 Seven Inch Soul - Vintage R&B</option>
                <option value="http://ice1.somafm.com/sf1033-128-mp3" data-genre="jazz">📻 SF 10-33 - Emergency Jazz</option>
                <option value="http://ice1.somafm.com/fluid-128-mp3" data-genre="jazz">💫 Fluid - Dub & Downtempo</option>
                
                <!-- AMBIENT -->
                <option value="http://ice1.somafm.com/deepspaceone-128-mp3" data-genre="ambient">🚀 Deep Space One - Space Music</option>
                <option value="http://ice1.somafm.com/dronezone-256-mp3" data-genre="ambient">🎧 Drone Zone - Meditation</option>
                <option value="http://ice1.somafm.com/spacestation-128-mp3" data-genre="ambient">🛸 Space Station Soma</option>
                <option value="http://ice1.somafm.com/sonicuniverse-256-mp3" data-genre="ambient">🌌 Sonic Universe - Cosmic</option>
                <option value="http://ice1.somafm.com/missioncontrol-128-mp3" data-genre="ambient">🛰️ Mission Control - Space</option>
                
                <!-- ROCK & ALTERNATIVE -->
                <option value="http://ice1.somafm.com/bagel-128-mp3" data-genre="rock">🥯 BAGeL Radio - Alternative</option>
                <option value="http://ice1.somafm.com/indiepop-128-mp3" data-genre="rock">🎸 Indie Pop Rocks</option>
                <option value="http://ice1.somafm.com/folkfwd-128-mp3" data-genre="rock">🪕 Folk Forward - Indie Folk</option>
                <option value="http://ice1.somafm.com/covers-128-mp3" data-genre="rock">🎤 Covers - Cover Songs</option>
                <option value="http://ice1.somafm.com/underground80s-128-mp3" data-genre="rock">📼 Underground 80s</option>
                <option value="http://ice1.somafm.com/rusty-128-mp3" data-genre="rock">🔧 Rusty - Garage Rock</option>
            </select>
            
            <div class="player-controls">
                <button class="control-btn" onclick="togglePlayPause()" id="playPauseBtn">▶</button>
                <button class="control-btn" onclick="stopRadio()">⏹</button>
                <button class="control-btn" onclick="muteToggle()" id="muteBtn">🔊</button>
            </div>
            
            <div class="volume-control">
                <span style="font-size: 12px;">🔉</span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" onchange="setVolume()">
                <span style="font-size: 12px;">🔊</span>
            </div>
            
            <div class="now-playing" id="nowPlaying">Select a station to start listening</div>
        </div>
    </div>

    <audio id="radioAudio" preload="none"></audio>

    <script>
        function selectProduct(asin) {
            if (confirm('Promote this product to all your connected platforms?')) {
                fetch('/api/promote-product', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({asin: asin})
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Product posted successfully to ' + data.platforms_posted + ' platforms!');
                          location.reload();
                      } else {
                          alert('Error: ' + data.error);
                      }
                  });
            }
        }

        function updateFrequency(hours) {
            fetch('/api/update-frequency', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({frequency_hours: parseInt(hours)})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Posting frequency updated!');
                  }
              });
        }

        function saveDiscord() {
            const webhookUrl = document.getElementById('discord_webhook').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'discord', webhook_url: webhookUrl})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Discord configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function saveTelegram() {
            const botToken = document.getElementById('telegram_bot_token').value;
            const chatId = document.getElementById('telegram_chat_id').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'telegram', bot_token: botToken, chat_id: chatId})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Telegram configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function saveSlack() {
            const botToken = document.getElementById('slack_bot_token').value;
            const channelId = document.getElementById('slack_channel_id').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'slack', bot_token: botToken, channel_id: channelId})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Slack configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        // Platform Settings Functions
        function togglePlatformSetup() {
            const form = document.getElementById('platform-setup-form');
            const btn = document.getElementById('platform-settings-btn');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                btn.textContent = '⬆️ Hide Platform Setup';
            } else {
                form.style.display = 'none';
                btn.textContent = '🔧 Configure Platforms';
            }
        }

        function saveDiscordSetup() {
            const webhookUrl = document.getElementById('discord_webhook_setup').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'discord', webhook_url: webhookUrl})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Discord configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function saveTelegramSetup() {
            const botToken = document.getElementById('telegram_bot_token_setup').value;
            const chatId = document.getElementById('telegram_chat_id_setup').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'telegram', bot_token: botToken, chat_id: chatId})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Telegram configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function saveSlackSetup() {
            const botToken = document.getElementById('slack_bot_token_setup').value;
            const channelId = document.getElementById('slack_channel_id_setup').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'slack', bot_token: botToken, channel_id: channelId})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Slack configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function savePinterestSetup() {
            const accessToken = document.getElementById('pinterest_access_token_setup').value;
            const boardId = document.getElementById('pinterest_board_id_setup').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: 'pinterest', access_token: accessToken, board_id: boardId})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Pinterest configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function saveRedditSetup() {
            const clientId = document.getElementById('reddit_client_id_setup').value;
            const clientSecret = document.getElementById('reddit_client_secret_setup').value;
            const username = document.getElementById('reddit_username_setup').value;
            const password = document.getElementById('reddit_password_setup').value;
            const subreddit = document.getElementById('reddit_subreddit_setup').value;
            fetch('/api/save-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    platform: 'reddit', 
                    client_id: clientId, 
                    client_secret: clientSecret,
                    username: username,
                    password: password,
                    subreddit: subreddit
                })
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Reddit configured successfully!');
                  } else {
                      alert('Error: ' + data.error);
                  }
              });
        }

        function testConnections() {
            fetch('/api/test-connections', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      let message = 'Connection Test Results:\n\n';
                      if (data.discord) message += '✅ Discord: Connected\n';
                      else message += '❌ Discord: Not configured\n';
                      if (data.telegram) message += '✅ Telegram: Connected\n';
                      else message += '❌ Telegram: Not configured\n';
                      if (data.slack) message += '✅ Slack: Connected\n';
                      else message += '❌ Slack: Not configured\n';
                      if (data.pinterest) message += '✅ Pinterest: Connected\n';
                      else message += '❌ Pinterest: Not configured\n';
                      if (data.reddit) message += '✅ Reddit: Connected\n';
                      else message += '❌ Reddit: Not configured\n';
                      alert(message);
                  } else {
                      alert('Test failed: ' + data.error);
                  }
              });
        }

        function promoteProducts(count) {
            fetch('/api/promote-products', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({count: count})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('✅ Success! Promoted ' + data.products_promoted + ' products to your platforms!');
                      location.reload();
                  } else {
                      alert('❌ Error: ' + data.error);
                  }
              });
        }

        function reportProblem() {
            const problemType = document.getElementById('problemType').value;
            const description = document.getElementById('problemDescription').value;
            
            if (!problemType || !description.trim()) {
                alert('Please select a problem type and provide a description.');
                return;
            }
            
            fetch('/api/report-problem', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    problem_type: problemType,
                    description: description.trim(),
                    user_agent: navigator.userAgent,
                    url: window.location.href
                })
            }).then(response => response.json())
              .then(data => {
                  const resultDiv = document.getElementById('problemReportResult');
                  if (data.success) {
                      resultDiv.innerHTML = '<div style="background: rgba(255,255,255,0.9); color: #2ecc71; padding: 10px; border-radius: 5px; font-weight: bold;">✅ Problem reported successfully! We\'ll look into it right away.</div>';
                      document.getElementById('problemType').value = '';
                      document.getElementById('problemDescription').value = '';
                  } else {
                      resultDiv.innerHTML = '<div style="background: rgba(255,255,255,0.9); color: #e74c3c; padding: 10px; border-radius: 5px; font-weight: bold;">❌ Failed to send report. Please try again.</div>';
                  }
                  resultDiv.style.display = 'block';
              });
        }

        function toggleAutoPosts() {
            fetch('/api/toggle-auto-posts', {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      location.reload();
                  }
              });
        }

        function postRandomProduct() {
            if (confirm('Post a random trending product to all platforms?')) {
                fetch('/api/post-random-product', {
                    method: 'POST'
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Product posted successfully!');
                          location.reload();
                      } else {
                          alert('Error: ' + data.error);
                      }
                  });
            }
        }

        function testAllWebhooks() {
            fetch('/api/test-all-webhooks', {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  alert('Webhook tests completed! Check the results above.');
                  location.reload();
              });
        }
        
        // AI Auto-Promotion Functions
        function autoPromoteProducts(numProducts = 3) {
            const resultDiv = document.getElementById('auto-promote-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-warning';
            resultDiv.innerHTML = '🤖 AI is selecting and promoting your top products...';
            
            fetch('/api/auto-promote', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    num_products: numProducts
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.className = 'alert alert-success';
                    resultDiv.innerHTML = `
                        <strong>🎉 Success!</strong><br>
                        Promoted ${data.products_promoted} products to ${data.total_platforms} platform(s)<br>
                        <small>${data.products.map(p => p.title.substring(0, 50) + '...').join('<br>')}</small>
                    `;
                    setTimeout(() => location.reload(), 2000);
                } else {
                    resultDiv.className = 'alert alert-danger';
                    resultDiv.innerHTML = `❌ ${data.error}`;
                }
            })
            .catch(error => {
                resultDiv.className = 'alert alert-danger';
                resultDiv.innerHTML = '❌ Error: Please check your webhook settings';
            });
        }
        
        // Amazon Product Search Functions
        function searchProducts() {
            const query = document.getElementById('product-search-input').value.trim();
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            const resultDiv = document.getElementById('search-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-warning';
            resultDiv.innerHTML = `🔍 Searching Amazon for "${query}"...`;
            
            fetch('/api/search-products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    limit: 20
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.className = 'alert alert-success';
                    let productsHtml = '';
                    if (data.products && data.products.length > 0) {
                        productsHtml = `
                            <div style="margin-top: 20px; border-top: 2px solid #667eea; padding-top: 15px;">
                                <h4 style="color: #333; margin-bottom: 15px;">🎯 Found Products (${data.products.length})</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; max-height: 400px; overflow-y: auto; padding: 10px;">
                        `;
                        data.products.forEach(product => {
                            productsHtml += `
                                <div style="border: 2px solid #e9ecef; padding: 15px; border-radius: 12px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='#e9ecef'; this.style.transform='translateY(0)'">
                                    <div style="height: 60px; overflow: hidden; margin-bottom: 10px;">
                                        <strong style="color: #333; font-size: 14px; line-height: 1.3;">${product.title.substring(0, 70)}${product.title.length > 70 ? '...' : ''}</strong>
                                    </div>
                                    <div style="margin: 8px 0; font-size: 12px; color: #666;">
                                        <span style="background: #f8f9fa; padding: 2px 6px; border-radius: 4px;">ASIN: ${product.asin}</span>
                                    </div>
                                    <div style="color: #e74c3c; font-weight: bold; margin: 8px 0;">${product.price}</div>
                                    <button onclick="promoteProduct('${product.asin}')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        🚀 Promote Now
                                    </button>
                                </div>
                            `;
                        });
                        productsHtml += '</div></div>';
                    }
                    
                    resultDiv.innerHTML = `
                        <strong>✅ Success!</strong> Found ${data.total_found} products, added ${data.products_added} new ones to your inventory
                        ${productsHtml}
                        <div style="margin-top: 10px;">
                            <a href="/products/browse" style="color: #007bff; text-decoration: none;">View all ${data.total_found} products in Browse Products →</a>
                        </div>
                    `;
                    document.getElementById('product-search-input').value = '';
                    // Don't reload the page anymore - keep results visible
                } else {
                    resultDiv.className = 'alert alert-danger';
                    resultDiv.innerHTML = `❌ ${data.message}`;
                }
            })
            .catch(error => {
                resultDiv.className = 'alert alert-danger';
                resultDiv.innerHTML = '❌ Error searching products';
            });
        }
        
        function searchPreset(query) {
            document.getElementById('product-search-input').value = query;
            searchProducts();
        }
        
        function promoteProduct(asin) {
            if (confirm('Promote this product to all your connected platforms?')) {
                fetch('/api/promote-product', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({asin: asin})
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('✅ Product promoted successfully to ' + data.platforms_posted + ' platforms!');
                      } else {
                          alert('❌ Error: ' + data.error);
                      }
                  }).catch(error => {
                      alert('❌ Error promoting product. Please check your webhook settings.');
                  });
            }
        }
        
        // Allow Enter key in search box
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('product-search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchProducts();
                    }
                });
            }
        });
        
        // Radio Player Variables
        let radioAudio = null;
        let isPlaying = false;
        let currentSource = 'radio';
        let spotifyPlayer = null;
        let spotifyDeviceId = null;
        
        // Initialize player
        document.addEventListener('DOMContentLoaded', function() {
            radioAudio = document.getElementById('radioAudio');
            setVolume();
            
            // Handle page refresh - if station is already selected, load it
            const selectedStation = document.getElementById('stationSelector').value;
            if (selectedStation && radioAudio) {
                radioAudio.src = selectedStation;
                radioAudio.load();
                updateNowPlaying('Station ready - Press play');
            }
        });
        
        // Switch between Radio and Spotify
        function switchSource(source) {
            currentSource = source;
            
            // Update tab appearance
            document.getElementById('radioTab').style.background = source === 'radio' ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)';
            document.getElementById('spotifyTab').style.background = source === 'spotify' ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)';
            
            // Show/hide sections
            document.getElementById('radioSection').style.display = source === 'radio' ? 'block' : 'none';
            document.getElementById('spotifySection').style.display = source === 'spotify' ? 'block' : 'none';
            
            // Stop current playback
            if (source === 'spotify' && radioAudio) {
                stopRadio();
            }
            
            updateNowPlaying(source === 'radio' ? 'Radio mode selected' : 'Spotify mode selected');
        }
        
        // Radio Functions
        function changeStation() {
            const stationUrl = document.getElementById('stationSelector').value;
            if (stationUrl) {
                const wasPlaying = isPlaying;
                radioAudio.src = stationUrl;
                radioAudio.load();
                
                if (wasPlaying) {
                    // Keep playing when switching stations
                    radioAudio.play().then(() => {
                        const stationName = document.getElementById('stationSelector').selectedOptions[0].text;
                        updateNowPlaying('Playing: ' + stationName);
                        document.getElementById('playPauseBtn').innerHTML = '⏸';
                        isPlaying = true;
                        
                        // Keep animations active
                        document.getElementById('radioPlayer').classList.add('playing');
                        document.getElementById('volumeVisualizer').style.display = 'flex';
                    }).catch(error => {
                        console.error('Error switching station:', error);
                        updateNowPlaying('Error loading station - try another');
                        document.getElementById('radioPlayer').classList.remove('playing');
                        document.getElementById('volumeVisualizer').style.display = 'none';
                    });
                } else {
                    updateNowPlaying('Station loaded. Click play to start.');
                }
            }
        }
        
        function togglePlayPause() {
            if (currentSource === 'radio') {
                toggleRadio();
            } else {
                toggleSpotify();
            }
        }
        
        function toggleRadio() {
            if (!radioAudio.src) {
                alert('Please select a radio station first');
                return;
            }
            
            if (isPlaying) {
                radioAudio.pause();
                document.getElementById('playPauseBtn').innerHTML = '▶';
                isPlaying = false;
                updateNowPlaying('Paused');
                
                // Deactivate animations when paused
                document.getElementById('radioPlayer').classList.remove('playing');
                document.getElementById('volumeVisualizer').style.display = 'none';
            } else {
                radioAudio.play().then(() => {
                    document.getElementById('playPauseBtn').innerHTML = '⏸';
                    isPlaying = true;
                    const stationName = document.getElementById('stationSelector').selectedOptions[0].text;
                    updateNowPlaying('Playing: ' + stationName);
                    
                    // Activate cool animations
                    document.getElementById('radioPlayer').classList.add('playing');
                    document.getElementById('volumeVisualizer').style.display = 'flex';
                }).catch(error => {
                    console.error('Error playing radio:', error);
                    updateNowPlaying('Error playing station');
                });
            }
        }
        
        function stopRadio() {
            if (radioAudio) {
                radioAudio.pause();
                radioAudio.currentTime = 0;
                document.getElementById('playPauseBtn').innerHTML = '▶';
                isPlaying = false;
                updateNowPlaying('Stopped');
                
                // Deactivate all animations when stopped
                document.getElementById('radioPlayer').classList.remove('playing');
                document.getElementById('volumeVisualizer').style.display = 'none';
            }
        }
        
        function setVolume() {
            const volume = document.getElementById('volumeSlider').value / 100;
            if (radioAudio) {
                radioAudio.volume = volume;
            }
            if (spotifyPlayer) {
                spotifyPlayer.setVolume(volume);
            }
        }
        
        function muteToggle() {
            const muteBtn = document.getElementById('muteBtn');
            if (radioAudio && currentSource === 'radio') {
                radioAudio.muted = !radioAudio.muted;
                muteBtn.innerHTML = radioAudio.muted ? '🔇' : '🔊';
            }
        }
        
        function togglePlayer() {
            const player = document.getElementById('radioPlayer');
            player.classList.toggle('minimized');
        }
        
        function updateNowPlaying(text) {
            document.getElementById('nowPlaying').textContent = text;
        }
        
        // Spotify Integration Functions
        function connectSpotify() {
            // Check if we have Spotify credentials configured
            fetch('/api/spotify-auth-url')
                .then(response => response.json())
                .then(data => {
                    if (data.auth_url) {
                        // Smooth redirect to Spotify authorization
                        updateNowPlaying('Connecting to Spotify...');
                        window.location.href = data.auth_url;
                    } else {
                        // Show Spotify coming soon message
                        document.getElementById('spotifyAuth').innerHTML = `
                            <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                                <p style="margin-bottom: 10px;">🎵 Spotify Integration</p>
                                <p style="font-size: 11px; opacity: 0.8;">Coming soon! Enjoy the radio stations for now.</p>
                                <p style="font-size: 10px; opacity: 0.6; margin-top: 8px;">15+ premium radio channels available</p>
                            </div>
                        `;
                        updateNowPlaying('Spotify setup needed');
                    }
                })
                .catch(error => {
                    updateNowPlaying('Spotify connection not available');
                });
        }
        
        function requestSpotifyAccess() {
            document.getElementById('spotifyAuth').innerHTML = `
                <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <p style="margin-bottom: 8px;">✅ Request submitted!</p>
                    <p style="font-size: 11px; opacity: 0.8;">You'll be notified when Spotify access is enabled</p>
                </div>
            `;
            updateNowPlaying('Spotify access requested');
        }
        
        function toggleSpotify() {
            if (spotifyPlayer) {
                spotifyPlayer.togglePlay().then(() => {
                    console.log('Toggled playback');
                });
            } else {
                updateNowPlaying('Connect Spotify account first');
            }
        }

        // Genre filtering functionality
        let allStations = [];

        function initializeStations() {
            const selector = document.getElementById('stationSelector');
            allStations = Array.from(selector.options).filter(option => option.value !== '');
        }

        function filterByGenre(genre) {
            // Update tab appearance
            document.querySelectorAll('.genre-tab').forEach(tab => {
                tab.style.background = 'rgba(255,255,255,0.1)';
            });
            document.getElementById(genre + 'Tab').style.background = 'rgba(255,255,255,0.3)';
            
            const selector = document.getElementById('stationSelector');
            const currentValue = selector.value; // Remember current selection
            
            // Clear current options
            selector.innerHTML = '<option value="">🎵 Select a Radio Station</option>';
            
            // Filter and add stations
            allStations.forEach(station => {
                if (genre === 'all' || station.dataset.genre === genre) {
                    const option = document.createElement('option');
                    option.value = station.value;
                    option.textContent = station.textContent;
                    option.dataset.genre = station.dataset.genre;
                    selector.appendChild(option);
                }
            });
            
            // Restore selection if it's still available
            if (currentValue && selector.querySelector(`option[value="${currentValue}"]`)) {
                selector.value = currentValue;
            }
        }

        // Initialize stations when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize radio audio element
            radioAudio = document.getElementById('radioAudio');
            if (radioAudio) {
                setVolume();
            }
            
            // Initialize stations for genre filtering
            setTimeout(initializeStations, 100);
        });
    </script>
</body>
</html>