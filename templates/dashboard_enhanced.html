<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AffiliateBot Pro - Enhanced Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header h1 { color: #333; font-size: 2.5em; margin-bottom: 10px; }
        .user-info { color: #666; font-size: 1.1em; }
        
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .card h3 { color: #333; margin-bottom: 15px; font-size: 1.4em; }
        
        .stats-card { text-align: center; }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 1.1em; }
        
        .platform-status { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .platform-badge { padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 0.9em; }
        .status-connected { background: #d4edda; color: #155724; }
        .status-disconnected { background: #f8d7da; color: #721c24; }
        .status-testing { background: #fff3cd; color: #856404; }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .product-card { background: #f8f9fa; border-radius: 10px; padding: 15px; border: 2px solid #e9ecef; transition: all 0.3s ease; }
        .product-card:hover { border-color: #667eea; transform: scale(1.02); }
        .product-image { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        .product-title { font-weight: bold; margin-bottom: 8px; color: #333; }
        .product-price { color: #667eea; font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .product-rating { color: #ffc107; margin-bottom: 10px; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a6fd8; transform: translateY(-2px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        
        .analytics-chart { background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .chart-bar { height: 30px; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 15px; margin: 10px 0; position: relative; }
        .chart-label { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: white; font-weight: bold; }
        
        /* Floating Radio Player Styles */
        .radio-player { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px; padding: 15px; width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; transition: all 0.3s ease; }
        .radio-player.minimized { width: 60px; height: 60px; padding: 10px; }
        .radio-player.minimized .player-content { display: none; }
        .radio-player.minimized .minimize-btn { transform: rotate(180deg); }
        
        /* Music Playing Animations */
        .radio-player.playing { animation: subtlePulse 2s ease-in-out infinite; }
        .radio-player.playing::before { content: ''; position: absolute; top: -3px; left: -3px; right: -3px; bottom: -3px; border-radius: 18px; background: linear-gradient(45deg, #667eea, #764ba2, #667eea); z-index: -1; animation: colorShift 4s ease-in-out infinite; opacity: 0.7; }
        .radio-player.playing .player-title::after { content: ' ‚ô™'; animation: musicNote 1.5s ease-in-out infinite; }
        
        @keyframes subtlePulse {
            0%, 100% { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 15px 40px rgba(102,126,234,0.4); }
        }
        
        @keyframes colorShift {
            0%, 100% { background: linear-gradient(45deg, #667eea, #764ba2, #667eea); }
            25% { background: linear-gradient(45deg, #764ba2, #667eea, #764ba2); }
            50% { background: linear-gradient(45deg, #667eea, #764ba2, #667eea); }
            75% { background: linear-gradient(45deg, #764ba2, #667eea, #764ba2); }
        }
        
        @keyframes musicNote {
            0%, 100% { opacity: 1; transform: translateY(0); }
            50% { opacity: 0.7; transform: translateY(-2px); }
        }
        
        /* Volume visualizer bars */
        .volume-visualizer { display: flex; align-items: center; gap: 2px; margin-left: 10px; }
        .volume-bar { width: 3px; background: rgba(255,255,255,0.6); border-radius: 2px; animation: volumeBounce 0.8s ease-in-out infinite; }
        .volume-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
        .volume-bar:nth-child(2) { height: 12px; animation-delay: 0.1s; }
        .volume-bar:nth-child(3) { height: 16px; animation-delay: 0.2s; }
        .volume-bar:nth-child(4) { height: 10px; animation-delay: 0.3s; }
        
        @keyframes volumeBounce {
            0%, 100% { transform: scaleY(0.3); opacity: 0.4; }
            50% { transform: scaleY(1); opacity: 1; }
        }
        .player-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .player-title { font-weight: bold; font-size: 14px; }
        .minimize-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-size: 12px; }
        .station-selector { 
            width: 100%; 
            background: rgba(255,255,255,0.1); 
            border: none; 
            color: white; 
            padding: 8px; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            position: relative; 
            z-index: 1002;
            max-height: 200px;
            overflow-y: auto;
        }
        .station-selector option { 
            background: #333; 
            color: white; 
            padding: 8px; 
            border: none;
        }
        .station-selector option:hover {
            background: #555;
        }
        .player-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .control-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 16px; transition: all 0.3s ease; }
        .control-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }
        .volume-control { display: flex; align-items: center; gap: 10px; }
        .volume-slider { width: 100%; }
        .now-playing { font-size: 12px; opacity: 0.8; text-align: center; margin-top: 5px; }
        
        .webhook-item { background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0; border-left: 5px solid #667eea; }
        .webhook-status { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        .status-green { background: #28a745; }
        .status-red { background: #dc3545; }
        .status-gray { background: #6c757d; }
        
        .schedule-controls { background: #e9ecef; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .frequency-selector { display: flex; gap: 15px; align-items: center; margin: 15px 0; }
        .frequency-selector label { font-weight: bold; }
        .frequency-selector select { padding: 8px 12px; border-radius: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ AffiliateBot Pro Enhanced Dashboard</h1>
            <div class="user-info">
                Welcome back, {{ current_user.first_name or current_user.email }}! 
                <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">
                    {{ current_user.subscription_tier|title }} Member
                </span>
            </div>
        </div>

        <!-- Affiliate Setup Alert -->
        {% if not current_user.amazon_affiliate_id %}
        <div class="card" style="border: 3px solid #ffc107; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);">
            <h3>‚ö†Ô∏è Complete Your Setup to Start Earning!</h3>
            <p style="margin: 15px 0; font-size: 1.1em;">You need to add your Amazon Associate ID to earn commissions from product promotions.</p>
            <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; margin: 15px 0;">
                <strong>Don't have an Amazon Associates account yet?</strong><br>
                1. Go to <a href="https://affiliate-program.amazon.com" target="_blank" style="color: #667eea;">affiliate-program.amazon.com</a><br>
                2. Sign up for free<br>
                3. Get your Associate ID (looks like "yourname-20")<br>
                4. Come back and enter it below
            </div>
            <a href="/setup" class="btn btn-warning" style="font-size: 1.2em; padding: 15px 30px;">üí∞ Complete Affiliate Setup Now</a>
        </div>
        {% endif %}

        <!-- Analytics Overview -->
        <div class="dashboard-grid">
            <div class="card stats-card">
                <h3>üí∞ Total Revenue</h3>
                <div class="stat-number">${{ "%.2f"|format(analytics.estimated_revenue or 0) }}</div>
                <div class="stat-label">Estimated Earnings</div>
            </div>
            <div class="card stats-card">
                <h3>üìä Total Posts</h3>
                <div class="stat-number">{{ analytics.total_posts or 0 }}</div>
                <div class="stat-label">Products Promoted</div>
            </div>
            <div class="card stats-card">
                <h3>üëÜ Total Clicks</h3>
                <div class="stat-number">{{ analytics.total_clicks or 0 }}</div>
                <div class="stat-label">Affiliate Clicks</div>
            </div>
            <div class="card stats-card">
                <h3>üìà Conversion Rate</h3>
                <div class="stat-number">{{ "%.1f"|format(analytics.conversion_rate or 0) }}%</div>
                <div class="stat-label">Click to Sale</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h3>‚ö° Quick Actions</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <a href="/products" class="btn btn-primary" style="text-decoration: none;">Browse Products</a>
                <a href="/campaigns" class="btn btn-success" style="text-decoration: none;">Manage Campaigns</a>
                <a href="/analytics" class="btn" style="background: purple; color: white; text-decoration: none;">View Analytics</a>
                <a href="/setup-webhooks" class="btn btn-warning" style="text-decoration: none;">Setup Webhooks</a>
            </div>
        </div>

        <!-- AI Auto-Promotion -->
        <div class="card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
            <h3>ü§ñ AI Auto-Promotion</h3>
            <p style="margin-bottom: 20px; opacity: 0.9;">Let AI automatically select and promote your top products</p>
            
            <button onclick="autoPromoteProducts(3)" style="width: 100%; background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px;">
                üöÄ Auto-Promote Top 3 Products
            </button>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="autoPromoteProducts(1)" style="background: rgba(255,255,255,0.2); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Promote 1
                </button>
                <button onclick="autoPromoteProducts(5)" style="background: rgba(255,255,255,0.2); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                    Promote 5
                </button>
            </div>
            
            <div id="auto-promote-result" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
        </div>

        <!-- Amazon Product Search -->
        <div class="card" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white;">
            <h3>üîç Amazon Product Search</h3>
            <p style="margin-bottom: 20px; opacity: 0.9;">Search Amazon directly and add products to your inventory</p>
            
            <input type="text" id="product-search-input" placeholder="Search any product..." style="width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; margin-bottom: 15px; color: #333;">
            
            <button onclick="searchProducts()" style="width: 100%; background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; font-weight: bold; padding: 15px 25px; border-radius: 10px; border: none; cursor: pointer; margin-bottom: 15px; font-size: 16px;">
                Search & Add to Inventory
            </button>
            
            {% if trending_searches %}
            <div style="margin-top: 15px;">
                <p style="margin-bottom: 10px; opacity: 0.9; font-size: 14px;">Trending searches:</p>
                <div>
                    {% for search in trending_searches %}
                    <span onclick="searchPreset('{{ search }}')" style="background: rgba(255,255,255,0.2); color: white; padding: 6px 12px; border-radius: 15px; margin: 3px; display: inline-block; cursor: pointer; font-size: 12px;">
                        {{ search }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <div id="search-result" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
        </div>

        <!-- Platform Status -->
        <div class="card">
            <h3>üîó Platform Connection Status</h3>
            <div class="platform-status">
                {% for webhook in user_webhooks %}
                <div class="platform-badge {{ 'status-connected' if webhook.last_test_success else 'status-disconnected' if webhook.last_test_time else 'status-testing' }}">
                    <span class="webhook-status {{ 'status-green' if webhook.last_test_success else 'status-red' if webhook.last_test_time else 'status-gray' }}"></span>
                    {{ webhook.name }} ({{ webhook.platform|title }})
                    <a href="/test-webhook/{{ webhook.id }}" class="btn btn-primary" style="margin-left: 10px; padding: 4px 8px; font-size: 0.8em;">Test</a>
                </div>
                {% endfor %}
            </div>
            <a href="/setup-webhooks" class="btn btn-primary">+ Add New Platform</a>
        </div>

        <!-- Product Selection with Visual Preview -->
        <div class="card">
            <h3>üõçÔ∏è Smart Product Selection</h3>
            <p style="color: #666; margin-bottom: 20px;">AI-curated products avoiding recent duplicates</p>
            
            <div class="product-grid">
                {% for product in trending_products[:6] %}
                <div class="product-card" onclick="selectProduct('{{ product.asin }}')">
                    <img src="{{ product.image_url or '/static/placeholder-product.png' }}" alt="{{ product.product_title }}" class="product-image">
                    <div class="product-title">{{ product.product_title[:50] }}...</div>
                    <div class="product-price">{{ product.price or 'Check Price' }}</div>
                    <div class="product-rating">‚≠ê {{ product.rating or 'N/A' }}/5</div>
                    <div style="font-size: 0.9em; color: #666;">
                        Promoted {{ product.times_promoted or 0 }} times
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div style="margin-top: 20px;">
                <a href="/products/refresh" class="btn btn-warning">üîÑ Refresh Products</a>
                <a href="/products/browse" class="btn btn-primary">üì± Browse All Products</a>
            </div>
        </div>

        <!-- Scheduling Configuration -->
        <div class="card">
            <h3>‚è∞ Smart Scheduling & Frequency</h3>
            <div class="schedule-controls">
                <div class="frequency-selector">
                    <label>Posting Frequency:</label>
                    <select onchange="updateFrequency(this.value)">
                        <option value="1" {{ 'selected' if current_user.post_frequency_hours == 1 else '' }}>Every Hour (Pro)</option>
                        <option value="3" {{ 'selected' if current_user.post_frequency_hours == 3 else '' }}>Every 3 Hours (Premium)</option>
                        <option value="12" {{ 'selected' if current_user.post_frequency_hours == 12 else '' }}>Every 12 Hours (Free)</option>
                    </select>
                </div>
                
                <div style="margin: 15px 0;">
                    <label style="font-weight: bold;">Auto-Posting:</label>
                    <button onclick="toggleAutoPosts()" class="btn {{ 'btn-success' if current_user.auto_post_enabled else 'btn-warning' }}">
                        {{ 'ON' if current_user.auto_post_enabled else 'OFF' }}
                    </button>
                </div>
                
                <div style="font-size: 0.9em; color: #666;">
                    Next scheduled post: <strong>{{ next_post_time or 'Manual only' }}</strong>
                </div>
            </div>
        </div>

        <!-- Mini Analytics Dashboard -->
        <div class="card">
            <h3>üìä Performance Analytics</h3>
            
            <div class="analytics-chart">
                <h4>Platform Performance</h4>
                {% for platform, stats in analytics.platform_stats.items() %}
                <div style="margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>{{ platform|title }}</span>
                        <span>{{ stats.posts }} posts, {{ stats.clicks }} clicks</span>
                    </div>
                    <div class="chart-bar" style="width: {{ (stats.clicks / (analytics.total_clicks or 1) * 100)|round }}%;">
                        <div class="chart-label">{{ stats.clicks }} clicks</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div style="margin-top: 20px;">
                <a href="/analytics/detailed" class="btn btn-primary">üìà Detailed Analytics</a>
                <a href="/analytics/export" class="btn btn-success">üìä Export Data</a>
            </div>
        </div>

        <!-- Admin Panel (if admin) -->
        {% if current_user.is_admin %}
        <div class="card" style="border: 3px solid #ffc107;">
            <h3>üëë Admin Panel</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="/admin" class="btn btn-warning">üìä Admin Dashboard</a>
                <a href="/admin/users" class="btn btn-primary">üë• View All Users</a>
                <a href="/admin/email-blast" class="btn btn-success">üìß Send Email Campaign</a>
                <a href="/admin/product-catalog" class="btn btn-primary">üõçÔ∏è Manage Products</a>
            </div>
        </div>
        {% endif %}

        <!-- Quick Actions -->
        <div class="card">
            <h3>‚ö° Quick Actions</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button onclick="postRandomProduct()" class="btn btn-primary">üöÄ Post Random Product</button>
                <button onclick="testAllWebhooks()" class="btn btn-warning">üß™ Test All Webhooks</button>
                <a href="/campaigns/new" class="btn btn-success">üìã Create Campaign</a>
                <a href="/settings" class="btn btn-primary">‚öôÔ∏è Settings</a>
            </div>
        </div>
    </div>

    <!-- Floating Radio Player -->
    <div class="radio-player" id="radioPlayer">
        <div class="player-header">
            <span class="player-title">üéµ Member Radio</span>
            <div class="volume-visualizer" id="volumeVisualizer" style="display: none;">
                <div class="volume-bar"></div>
                <div class="volume-bar"></div>
                <div class="volume-bar"></div>
                <div class="volume-bar"></div>
            </div>
            <button class="minimize-btn" onclick="togglePlayer()">‚àí</button>
        </div>
        <div class="player-content">
            <!-- Music Source Tabs -->
            <div style="display: flex; margin-bottom: 10px;">
                <button class="source-tab active" onclick="switchSource('radio')" id="radioTab" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.3); border: none; color: white; border-radius: 8px 0 0 8px; cursor: pointer;">
                    üìª Radio
                </button>
                <button class="source-tab" onclick="switchSource('spotify')" id="spotifyTab" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 0 8px 8px 0; cursor: pointer;">
                    üéµ Spotify
                </button>
            </div>
            
            <!-- Radio Section -->
            <div id="radioSection">
                <select class="station-selector" id="stationSelector" onchange="changeStation()" size="1">
                    <option value="">Select a Station</option>
                    <option value="https://streams.ilovemusic.de/iloveradio1.mp3">I Love Radio (Pop)</option>
                    <option value="https://playerservices.streamtheworld.com/api/livestream-redirect/TLPSTR01.mp3">The Lounge (Chill)</option>
                    <option value="https://stream.rcast.net/8042">Chillout Radio</option>
                    <option value="https://stream.rcast.net/8006">Ambient Music</option>
                    <option value="https://stream.rcast.net/8054">Jazz 24/7</option>
                    <option value="http://ice1.somafm.com/beatblender-128-mp3">Beat Blender (Electronic)</option>
                    <option value="http://ice1.somafm.com/bagel-128-mp3">BAGeL Radio (Alternative)</option>
                    <option value="http://ice1.somafm.com/groovesalad-256-mp3">Groove Salad (Chill)</option>
                    <option value="http://ice1.somafm.com/deepspaceone-128-mp3">Deep Space One (Ambient)</option>
                    <option value="http://ice1.somafm.com/dronezone-256-mp3">Drone Zone (Ambient)</option>
                    <option value="http://ice1.somafm.com/lush-128-mp3">Lush (Chillout)</option>
                    <option value="http://ice1.somafm.com/secretagent-128-mp3">Secret Agent (Downtempo)</option>
                    <option value="http://ice1.somafm.com/defcon-256-mp3">DEF CON Radio (Electronic)</option>
                    <option value="https://stream.rcast.net/8001">Smooth Jazz</option>
                    <option value="https://stream.rcast.net/8003">Classic Rock</option>
                </select>
            </div>
            
            <!-- Spotify Section -->
            <div id="spotifySection" style="display: none;">
                <div id="spotifyAuth" style="text-align: center; padding: 15px;">
                    <button onclick="connectSpotify()" style="background: #1DB954; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold;">
                        Connect Spotify Account
                    </button>
                    <p style="font-size: 11px; margin-top: 8px; opacity: 0.8;">Connect your Spotify Premium account to control your music</p>
                </div>
                <div id="spotifyPlayer" style="display: none;">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <img id="spotifyAlbumArt" src="" alt="Album Art" style="width: 60px; height: 60px; border-radius: 8px; display: none;">
                        <div id="spotifyTrackInfo" style="font-size: 12px; margin-top: 5px;">Ready to play</div>
                    </div>
                </div>
            </div>
            
            <div class="player-controls">
                <button class="control-btn" onclick="togglePlayPause()" id="playPauseBtn">‚ñ∂</button>
                <button class="control-btn" onclick="stopRadio()">‚èπ</button>
                <button class="control-btn" onclick="muteToggle()" id="muteBtn">üîä</button>
            </div>
            
            <div class="volume-control">
                <span style="font-size: 12px;">üîâ</span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" onchange="setVolume()">
                <span style="font-size: 12px;">üîä</span>
            </div>
            
            <div class="now-playing" id="nowPlaying">Select a station to start listening</div>
        </div>
    </div>

    <audio id="radioAudio" preload="none"></audio>

    <script>
        function selectProduct(asin) {
            if (confirm('Promote this product to all your connected platforms?')) {
                fetch('/api/promote-product', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({asin: asin})
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Product posted successfully to ' + data.platforms_posted + ' platforms!');
                          location.reload();
                      } else {
                          alert('Error: ' + data.error);
                      }
                  });
            }
        }

        function updateFrequency(hours) {
            fetch('/api/update-frequency', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({frequency_hours: parseInt(hours)})
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      alert('Posting frequency updated!');
                  }
              });
        }

        function toggleAutoPosts() {
            fetch('/api/toggle-auto-posts', {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      location.reload();
                  }
              });
        }

        function postRandomProduct() {
            if (confirm('Post a random trending product to all platforms?')) {
                fetch('/api/post-random-product', {
                    method: 'POST'
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert('Product posted successfully!');
                          location.reload();
                      } else {
                          alert('Error: ' + data.error);
                      }
                  });
            }
        }

        function testAllWebhooks() {
            fetch('/api/test-all-webhooks', {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  alert('Webhook tests completed! Check the results above.');
                  location.reload();
              });
        }
        
        // AI Auto-Promotion Functions
        function autoPromoteProducts(numProducts = 3) {
            const resultDiv = document.getElementById('auto-promote-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-warning';
            resultDiv.innerHTML = 'ü§ñ AI is selecting and promoting your top products...';
            
            fetch('/api/auto-promote', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    num_products: numProducts
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.className = 'alert alert-success';
                    resultDiv.innerHTML = `
                        <strong>üéâ Success!</strong><br>
                        Promoted ${data.products_promoted} products to ${data.total_platforms} platform(s)<br>
                        <small>${data.products.map(p => p.title.substring(0, 50) + '...').join('<br>')}</small>
                    `;
                    setTimeout(() => location.reload(), 2000);
                } else {
                    resultDiv.className = 'alert alert-danger';
                    resultDiv.innerHTML = `‚ùå ${data.error}`;
                }
            })
            .catch(error => {
                resultDiv.className = 'alert alert-danger';
                resultDiv.innerHTML = '‚ùå Error: Please check your webhook settings';
            });
        }
        
        // Amazon Product Search Functions
        function searchProducts() {
            const query = document.getElementById('product-search-input').value.trim();
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            const resultDiv = document.getElementById('search-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-warning';
            resultDiv.innerHTML = `üîç Searching Amazon for "${query}"...`;
            
            fetch('/api/search-products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    limit: 20
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.className = 'alert alert-success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ ${data.message}</strong><br>
                        Found ${data.total_found} products, added ${data.products_added} new ones to your inventory
                    `;
                    document.getElementById('product-search-input').value = '';
                    setTimeout(() => location.reload(), 2000);
                } else {
                    resultDiv.className = 'alert alert-danger';
                    resultDiv.innerHTML = `‚ùå ${data.message}`;
                }
            })
            .catch(error => {
                resultDiv.className = 'alert alert-danger';
                resultDiv.innerHTML = '‚ùå Error searching products';
            });
        }
        
        function searchPreset(query) {
            document.getElementById('product-search-input').value = query;
            searchProducts();
        }
        
        // Allow Enter key in search box
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('product-search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchProducts();
                    }
                });
            }
        });
        
        // Radio Player Variables
        let radioAudio = null;
        let isPlaying = false;
        let currentSource = 'radio';
        let spotifyPlayer = null;
        let spotifyDeviceId = null;
        
        // Initialize player
        document.addEventListener('DOMContentLoaded', function() {
            radioAudio = document.getElementById('radioAudio');
            setVolume();
        });
        
        // Switch between Radio and Spotify
        function switchSource(source) {
            currentSource = source;
            
            // Update tab appearance
            document.getElementById('radioTab').style.background = source === 'radio' ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)';
            document.getElementById('spotifyTab').style.background = source === 'spotify' ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)';
            
            // Show/hide sections
            document.getElementById('radioSection').style.display = source === 'radio' ? 'block' : 'none';
            document.getElementById('spotifySection').style.display = source === 'spotify' ? 'block' : 'none';
            
            // Stop current playback
            if (source === 'spotify' && radioAudio) {
                stopRadio();
            }
            
            updateNowPlaying(source === 'radio' ? 'Radio mode selected' : 'Spotify mode selected');
        }
        
        // Radio Functions
        function changeStation() {
            const stationUrl = document.getElementById('stationSelector').value;
            if (stationUrl) {
                radioAudio.src = stationUrl;
                updateNowPlaying('Station loaded. Click play to start.');
            }
        }
        
        function togglePlayPause() {
            if (currentSource === 'radio') {
                toggleRadio();
            } else {
                toggleSpotify();
            }
        }
        
        function toggleRadio() {
            if (!radioAudio.src) {
                alert('Please select a radio station first');
                return;
            }
            
            if (isPlaying) {
                radioAudio.pause();
                document.getElementById('playPauseBtn').innerHTML = '‚ñ∂';
                isPlaying = false;
                updateNowPlaying('Paused');
                
                // Deactivate animations when paused
                document.getElementById('radioPlayer').classList.remove('playing');
                document.getElementById('volumeVisualizer').style.display = 'none';
            } else {
                radioAudio.play().then(() => {
                    document.getElementById('playPauseBtn').innerHTML = '‚è∏';
                    isPlaying = true;
                    const stationName = document.getElementById('stationSelector').selectedOptions[0].text;
                    updateNowPlaying('Playing: ' + stationName);
                    
                    // Activate cool animations
                    document.getElementById('radioPlayer').classList.add('playing');
                    document.getElementById('volumeVisualizer').style.display = 'flex';
                }).catch(error => {
                    console.error('Error playing radio:', error);
                    updateNowPlaying('Error playing station');
                });
            }
        }
        
        function stopRadio() {
            if (radioAudio) {
                radioAudio.pause();
                radioAudio.currentTime = 0;
                document.getElementById('playPauseBtn').innerHTML = '‚ñ∂';
                isPlaying = false;
                updateNowPlaying('Stopped');
                
                // Deactivate all animations when stopped
                document.getElementById('radioPlayer').classList.remove('playing');
                document.getElementById('volumeVisualizer').style.display = 'none';
            }
        }
        
        function setVolume() {
            const volume = document.getElementById('volumeSlider').value / 100;
            if (radioAudio) {
                radioAudio.volume = volume;
            }
            if (spotifyPlayer) {
                spotifyPlayer.setVolume(volume);
            }
        }
        
        function muteToggle() {
            const muteBtn = document.getElementById('muteBtn');
            if (radioAudio && currentSource === 'radio') {
                radioAudio.muted = !radioAudio.muted;
                muteBtn.innerHTML = radioAudio.muted ? 'üîá' : 'üîä';
            }
        }
        
        function togglePlayer() {
            const player = document.getElementById('radioPlayer');
            player.classList.toggle('minimized');
        }
        
        function updateNowPlaying(text) {
            document.getElementById('nowPlaying').textContent = text;
        }
        
        // Spotify Integration Functions
        function connectSpotify() {
            // Check if we have Spotify credentials configured
            fetch('/api/spotify-auth-url')
                .then(response => response.json())
                .then(data => {
                    if (data.auth_url) {
                        // Smooth redirect to Spotify authorization
                        updateNowPlaying('Connecting to Spotify...');
                        window.location.href = data.auth_url;
                    } else {
                        // Show inline message instead of popup
                        document.getElementById('spotifyAuth').innerHTML = `
                            <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                                <p style="margin-bottom: 10px;">üéµ Spotify integration available!</p>
                                <p style="font-size: 11px; opacity: 0.8;">Contact admin to enable Spotify for your account</p>
                                <button onclick="requestSpotifyAccess()" style="background: #1DB954; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 12px; margin-top: 8px;">
                                    Request Access
                                </button>
                            </div>
                        `;
                        updateNowPlaying('Spotify setup needed');
                    }
                })
                .catch(error => {
                    updateNowPlaying('Spotify connection not available');
                });
        }
        
        function requestSpotifyAccess() {
            document.getElementById('spotifyAuth').innerHTML = `
                <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <p style="margin-bottom: 8px;">‚úÖ Request submitted!</p>
                    <p style="font-size: 11px; opacity: 0.8;">You'll be notified when Spotify access is enabled</p>
                </div>
            `;
            updateNowPlaying('Spotify access requested');
        }
        
        function toggleSpotify() {
            if (spotifyPlayer) {
                spotifyPlayer.togglePlay().then(() => {
                    console.log('Toggled playback');
                });
            } else {
                updateNowPlaying('Connect Spotify account first');
            }
        }
    </script>
</body>
</html>