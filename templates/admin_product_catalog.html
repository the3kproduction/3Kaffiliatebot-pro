<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog Management - AffiliateBot Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .back-btn { position: absolute; top: 20px; left: 20px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 12px 25px; border: none; border-radius: 25px; text-decoration: none; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; text-align: center; backdrop-filter: blur(10px); }
        .stat-number { font-size: 2.2em; font-weight: bold; color: #4CAF50; }
        .stat-label { font-size: 1em; margin-top: 8px; opacity: 0.9; }
        
        .controls-section { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin-bottom: 30px; backdrop-filter: blur(10px); }
        .controls-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .btn { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 12px 20px; border: none; border-radius: 25px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 14px; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .btn-danger { background: linear-gradient(135deg, #f44336, #d32f2f); }
        .btn-warning { background: linear-gradient(135deg, #FF9800, #F57C00); }
        .btn-info { background: linear-gradient(135deg, #2196F3, #1976D2); }
        
        .products-table { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; backdrop-filter: blur(10px); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
        th { background: rgba(255,255,255,0.1); font-weight: bold; position: sticky; top: 0; }
        .product-image { width: 60px; height: 60px; object-fit: contain; border-radius: 8px; background: rgba(255,255,255,0.1); }
        .product-title { max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .status-badge { padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .active { background: #4CAF50; }
        .inactive { background: #9E9E9E; }
        .trending { background: #FF9800; }
        .action-btn { padding: 6px 12px; margin: 2px; border-radius: 15px; border: none; cursor: pointer; font-size: 12px; }
        .toggle-btn { background: #2196F3; color: white; }
        .delete-btn { background: #f44336; color: white; }
        
        .search-section { margin-bottom: 20px; }
        .search-input { width: 100%; max-width: 400px; padding: 12px 20px; border: none; border-radius: 25px; background: rgba(255,255,255,0.1); color: white; font-size: 16px; }
        .search-input::placeholder { color: rgba(255,255,255,0.7); }
        
        .pagination { text-align: center; margin-top: 20px; }
        .pagination button { background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; margin: 0 5px; border-radius: 20px; cursor: pointer; }
        .pagination button.active { background: #4CAF50; }
    </style>
</head>
<body>
    <a href="/admin" class="back-btn">‚Üê Back to Admin</a>
    
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è Product Catalog Management</h1>
            <p>Manage your affiliate product inventory</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ total_products }}</div>
                <div class="stat-label">Total Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ active_products }}</div>
                <div class="stat-label">Active Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ trending_products }}</div>
                <div class="stat-label">Trending Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ ((active_products / total_products) * 100) | round(1) if total_products > 0 else 0 }}%</div>
                <div class="stat-label">Active Rate</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="controls-section">
            <h3>üöÄ Quick Actions</h3>
            <div class="controls-grid">
                <button onclick="refreshProducts()" class="btn btn-info">üîÑ Refresh Product Data</button>
                <button onclick="bulkToggleActive()" class="btn btn-warning">‚ö° Bulk Toggle Active</button>
                <button onclick="clearInactiveProducts()" class="btn btn-danger">üóëÔ∏è Clear Inactive Products</button>
                <button onclick="exportProductData()" class="btn">üìä Export Data</button>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="search-section">
            <input type="text" id="searchInput" class="search-input" placeholder="üîç Search products by title, ASIN, or category..." onkeyup="filterProducts()">
        </div>

        <!-- Products Table -->
        <div class="products-table">
            <table id="productsTable">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Product Title</th>
                        <th>ASIN</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Rating</th>
                        <th>Promoted</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr data-asin="{{ product.asin }}">
                        <td>
                            <img src="{{ product.image_url or 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5IiBmb250LXNpemU9IjEwIj5Qcm9kdWN0PC90ZXh0Pgo8L3N2Zz4=' }}" 
                                 alt="Product" class="product-image" 
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5IiBmb250LXNpemU9IjEwIj5Qcm9kdWN0PC90ZXh0Pgo8L3N2Zz4='">
                        </td>
                        <td class="product-title" title="{{ product.product_title }}">{{ product.product_title }}</td>
                        <td>{{ product.asin }}</td>
                        <td>{{ product.category or 'N/A' }}</td>
                        <td>{{ product.price or 'N/A' }}</td>
                        <td>
                            {% if product.rating %}
                                {{ product.rating }}/5 ‚≠ê
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ product.times_promoted }}x</td>
                        <td>
                            <span class="status-badge {{ 'active' if product.is_active else 'inactive' }}">
                                {{ 'Active' if product.is_active else 'Inactive' }}
                            </span>
                            {% if product.is_trending %}
                                <span class="status-badge trending">Trending</span>
                            {% endif %}
                        </td>
                        <td>
                            <button onclick="toggleActive('{{ product.asin }}')" class="action-btn toggle-btn">
                                {{ 'Deactivate' if product.is_active else 'Activate' }}
                            </button>
                            <button onclick="toggleTrending('{{ product.asin }}')" class="action-btn toggle-btn">
                                {{ 'Untrend' if product.is_trending else 'Trend' }}
                            </button>
                            <button onclick="deleteProduct('{{ product.asin }}')" class="action-btn delete-btn">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if not products %}
            <div style="text-align: center; padding: 60px;">
                <h3>No Products Found</h3>
                <p>Your product catalog is empty. Use the search feature to add products!</p>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        function toggleActive(asin) {
            fetch(`/admin/product-catalog/toggle-active/${asin}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }

        function toggleTrending(asin) {
            fetch(`/admin/product-catalog/toggle-trending/${asin}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }

        function deleteProduct(asin) {
            if (confirm('Are you sure you want to delete this product? This cannot be undone.')) {
                fetch(`/admin/product-catalog/delete/${asin}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    alert('Error: ' + error);
                });
            }
        }

        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const table = document.getElementById('productsTable');
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const title = row.cells[1].textContent.toLowerCase();
                const asin = row.cells[2].textContent.toLowerCase();
                const category = row.cells[3].textContent.toLowerCase();
                
                if (title.includes(searchTerm) || asin.includes(searchTerm) || category.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        function refreshProducts() {
            alert('Product refresh feature coming soon! Use the search function to add new products.');
        }

        function bulkToggleActive() {
            alert('Bulk operations coming soon!');
        }

        function clearInactiveProducts() {
            if (confirm('Are you sure you want to delete all inactive products? This cannot be undone.')) {
                alert('Bulk deletion feature coming soon!');
            }
        }

        function exportProductData() {
            alert('Export feature coming soon!');
        }
    </script>
</body>
</html>